
#include "bignum_util.h"
#include "bignum_div.h"

#include "bignum_debug.h"

/* 
    Example)
                     ┌────────────────────────────────────
     0x2312_89ABCDEF │0x1234567_89ABCDEF_01234567_89ABCDEF

    step 1)
    0x1234567_89ABCDEF_1234567_89ABCDEF ÷ 0x2312_00000000 = 0x84E_00000000_00000000

                                  0x84E_00000000_00000000
                    ┌────────────────────────────────────
    0x2312_00000000 │0x1234567_89ABCDEF_01234567_89ABCDEF
    
    1, 3,
 
    0x00000000_89ABCDEF × 0x84E_00000000_00000000 =  0x50C836D2_00000000_00000000
 */

int32_t BN_Div(__OUT BIGNUM_t* result, __INOUT BIGNUM_t* temp, __IN BIGNUM_t* op1, __IN BIGNUM_t* op2)
{

    int32_t ret;
    BIGNUM_t* pNumerator;   /* 분자 */
    BIGNUM_t* pDenominator; /* 분모 */

    volatile int32_t    WordIndex;
    volatile int32_t    NumeratorIndex;
    volatile int32_t    DenominatorIndex;
    int32_t             DiffWordIndex;

    ret = BN_ucmp(op1, op2);
    if(ret >= 0)
    {
        pDenominator    = op1;
        pNumerator      = op2;
    }
    else
    {
        pDenominator    = op2;
        pNumerator      = op1;
    }
    
    if(ret != 0)
    {
        ret = BN_ucpy(temp, pDenominator);
        if(ret == 0)
        {
            /* 
                Example)
                    0xc16dc643ac04cb97efa9154a9c2ce9817ce024363cacd4243498c117/0xb551d129734d12bc45260896ac470dd
                    = 0x00000011_118bdf4e_5d0756fc_fabec1ff

                    pNumerator->length      : 3
                    pDenominator->length    : 6
                    DiffWordIndex           : 3
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0xc16dc643_ac04cb97_efa9154a_9c2ce981_7ce02436_3cacd424_3498c117
            
                loop 1)
                     0x00000000_c16dc643 ÷ 0x00000000_0b551d12 = 0x00000011
                                                                                      0x00000011_00000000_00000000_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0xc16dc643_ac04cb97_efa9154a_9c2ce981_7ce02436_3cacd424_3498c117
                                                           0xc0a6ee3c_0a81e3e8_09786920_170b7ead_00000000_00000000_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                           0x00c6d807_a182e7af_e630ac2a_85216ad4_7ce02436_3cacd424_3498c117
                                                           
                ==============================================================================================================

                loop 2)
                     0x00c6d807_a182e7af ÷ 0x00000000_0b551d12 = 0x118bdf4f
                                                                                      0x00000000_118bdf4f_00000000_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00c6d807_a182e7af_e630ac2a_85216ad4_7ce02436_3cacd424_3498c117
                                                           0x00c6d807_a8b9c605_264ebda8_e2378291_05ee5733_00000000_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_0736de55_401e117e_5d1617bc_890e32fc_c3532bdb_cb673ee9
                
                Sub loop 1)
                    0x00c6d807_a8b9c605_264ebda8_e2378291_05ee5733_00000000_00000000 - 0xb551d12_9734d12b_c4526089_6ac470dd_00000000_00000000
                    = 0x00c6d807_9d64a8f2_8f19ec7d_1de52207_9b29e656_00000000_00000000

                    0x118bdf4f - 1 = 0x118bdf4e

                                                                                      0x00000000_118bdf4e_00000000_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00c6d807_a182e7af_e630ac2a_85216ad4_7ce02436_3cacd424_3498c117
                                                           0x00c6d807_9d64a8f2_8f19ec7d_1de52207_9b29e656_00000000_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                           0x00000000_041e3ebd_5716bfad_673c48cc_e1b63de0_3cacd424_3498c117
                                                           
                ==============================================================================================================
                
                loop 3)
                     0x041e3ebd_5716bfad ÷ 0x00000000_0b551d12 = 0x5d075701
                                                                                      0x00000000_00000000_5d075701_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_041e3ebd_5716bfad_673c48cc_e1b63de0_3cacd424_3498c117
                                                           0x00000000_041e3ebd_84a6c0e4_28cefc36_52ac5c31_8c2a8bdd_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_2d900136_c192b369_70f61e51_4f7db7b8_cb673ee9

                Sub loop 1)
                    0x00000000_041e3ebd_84a6c0e4_28cefc36_52ac5c31_8c2a8bdd_00000000 - [ (0xb551d12_9734d12b_c4526089_6ac470dd_00000000) * 1 ]
                    = 0x00000000_041e3ebd_7951a3d1_919a2b0a_8e59fba8_21661b00_00000000

                    0x5d075701 - 1 = 0x5d075700

                                                                                      0x00000000_00000000_5d075700_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_041e3ebd_5716bfad_673c48cc_e1b63de0_3cacd424_3498c117
                                                           0x00000000_041e3ebd_7951a3d1_919a2b0a_8e59fba8_21661b00_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_223ae424_2a5de23d_aca3bdc7_e4b946db_cb673ee9
                
                Sub loop 2)
                    0x00000000_041e3ebd_84a6c0e4_28cefc36_52ac5c31_8c2a8bdd_00000000 - [ (0xb551d12_9734d12b_c4526089_6ac470dd_00000000) * 2 ]
                    = 0x00000000_041e3ebd_6dfc86be_fa6559de_ca079b1e_b6a1aa23_00000000

                    0x5d075701 - 2 = 0x5d0756FF

                                                                                      0x00000000_00000000_5d0756FF_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_041e3ebd_5716bfad_673c48cc_e1b63de0_3cacd424_3498c117
                                                           0x00000000_041e3ebd_6dfc86be_fa6559de_ca079b1e_b6a1aa23_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_16e5c711_93291111_e8515d3e_79f4d5fe_cb673ee9

                Sub loop 3)
                    0x00000000_041e3ebd_84a6c0e4_28cefc36_52ac5c31_8c2a8bdd_00000000 - [ (0xb551d12_9734d12b_c4526089_6ac470dd_00000000) * 3 ]
                    = 0x00000000_041e3ebd_62a769ac_633088b3_05b53a95_4bdd3946_00000000

                    0x5d075701 - 3 = 0x5d0756FE

                                                                                      0x00000000_00000000_5d0756FE_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_041e3ebd_5716bfad_673c48cc_e1b63de0_3cacd424_3498c117
                                                           0x00000000_041e3ebd_62a769ac_633088b3_05b53a95_4bdd3946_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_0b90a9fe_fbf43fe6_23fefcb5_0f306521_cb673ee9
                
                Sub loop 4)
                    0x00000000_041e3ebd_84a6c0e4_28cefc36_52ac5c31_8c2a8bdd_00000000 - [ (0xb551d12_9734d12b_c4526089_6ac470dd_00000000) * 4 ]
                    = 0x00000000_041e3ebd_57524c99_cbfbb787_4162da0b_e118c869_00000000

                    0x5d075701 - 4 = 0x5d0756FD

                                                                                      0x00000000_00000000_5d0756FD_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_041e3ebd_5716bfad_673c48cc_e1b63de0_3cacd424_3498c117
                                                           0x00000000_041e3ebd_57524c99_cbfbb787_4162da0b_e118c869_00000000                        
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_003b8cec_64bf6eba_5fac9c2b_a46bf444_cb673ee9
                
                Sub loop 5)
                    0x00000000_041e3ebd_84a6c0e4_28cefc36_52ac5c31_8c2a8bdd_00000000 - [ (0xb551d12_9734d12b_c4526089_6ac470dd_00000000) * 5 ]
                    = 

                    0x5d075701 - 5 = 0x5d0756FC

                                                                                      0x00000000_00000000_5d0756FC_00000000
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_041e3ebd_5716bfad_673c48cc_e1b63de0_3cacd424_3498c117
                                                           0x00000000_041e3ebd_4bfd2f87_34c6e65b_7d107982_7654578c_00000000
                                                           ──────────────────────────────────────────────────────────────────
                                                           0x00000000_00000000_0b199026_32756271_64a5c45d_c6587c98_3498c117  

                ==============================================================================================================
                
                loop 4)
                     0x0b199026_32756271 ÷ 0x00000000_0b551d12 = 0xfabec20c
                                                                                      0x00000000_00000000_00000000_fabec20c
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_00000000_0b199026_32756271_64a5c45d_c6587c98_3498c117
                                                           0x00000000_00000000_0b199026_c37b40ed_1931203d_7945bd5d_74c2c45c
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_00000000_9105de7b_b48b5bdf_b2ed40c5_402a0345

                Sub loop 1)
                    0x00000000_00000000_0b199026_c37b40ed_1931203d_7945bd5d_74c2c45c - [ (0xb551d12_9734d12b_c4526089_6ac470dd) * 1 ]
                    = 0x0b199026_b82623da_81fc4f11_b4f35cd4_09fe537f

                    0xfabec20c - 1 = 0xfabec20b

                                                                                      0x00000000_00000000_00000000_fabec20b
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_00000000_0b199026_32756271_64a5c45d_c6587c98_3498c117
                                                           0x00000000_00000000_0b199026_b82623da_81fc4f11_b4f35cd4_09fe537f
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_00000000_85b0c169_1d568ab3_ee9ae03b_d5659268
                    
                Sub loop 2)
                    0x00000000_00000000_0b199026_c37b40ed_1931203d_7945bd5d_74c2c45c - [ (0xb551d12_9734d12b_c4526089_6ac470dd) * 2 ]
                    = 0x0b199026_acd106c7_eac77de5_f0a0fc4a_9f39e2a2

                    0xfabec20c - 2 = 0xfabec20a

                                                                                      0x00000000_00000000_00000000_fabec20a
                                                          ┌──────────────────────────────────────────────────────────────────
                     0xb551d12_9734d12b_c4526089_6ac470dd │0x00000000_00000000_0b199026_32756271_64a5c45d_c6587c98_3498c117
                                                           0x00000000_00000000_0b199026_acd106c7_eac77de5_f0a0fc4a_9f39e2a2
                                                           ──────────────────────────────────────────────────────────────────
                                                         - 0x00000000_00000000_00000000_7a5ba456_8621b988_2a487fb2_6aa1218b                                 
             */

            DiffWordIndex = pDenominator->length - pNumerator->length;
            for(WordIndex = DiffWordIndex; WordIndex > -1; WordIndex -= 1)
            {

            }
        }
    }
    else
    {
        BN_Clear(result);
        result->pWord[0] = 1U;
        ret = 0;
    }

    return ret;
}


